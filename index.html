<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beyond the BMI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script>tailwind.config={theme:{extend:{fontFamily:{inter:['Inter','sans-serif']}}}}</script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; color: #1f2937; }
        /* Minified Custom Classes to reduce HTML size */
        .card { background: white; padding: 1.5rem; border-radius: 0.75rem; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
        .btn { padding: 0.75rem 1.5rem; border-radius: 0.5rem; font-weight: 600; transition: 0.2s; color: white; }
        .btn-p { background: #16a34a; width: 100%; } .btn-p:hover { background: #15803d; }
        .btn-s { background: #4b5563; width: 30%; } .btn-s:hover { background: #374151; }
        .btn-auth { background: #4f46e5; font-size: 0.875rem; } .btn-auth:hover { background: #4338ca; }
        .inp { width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 0.5rem; outline: none; }
        .inp:focus { border-color: #6366f1; ring: 2px solid #6366f1; }
        .hist-list::-webkit-scrollbar { width: 6px; }
        .hist-list::-webkit-scrollbar-thumb { background: #9ca3af; border-radius: 4px; }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen">

    <!-- App Container -->
    <div class="max-w-7xl mx-auto">
        
        <!-- Header -->
        <header class="mb-8 flex flex-col sm:flex-row justify-between items-center gap-4">
            <h1 class="text-3xl font-bold text-indigo-600 text-center sm:text-left">Beyond the BMI<span class="block text-xl font-medium text-gray-600">and your health tracker</span></h1>
            <div class="bg-white p-3 rounded-lg shadow-sm flex items-center gap-3">
                <span id="auth-status" class="text-xs text-gray-500">Loading...</span>
                <button id="auth-btn" class="btn btn-auth">Sign In</button>
            </div>
        </header>

        <!-- Content Grid -->
        <main class="grid grid-cols-1 md:grid-cols-3 gap-6">
            
            <!-- Left Column: Tools -->
            <div class="md:col-span-2 flex flex-col gap-6">
                <!-- Calculator -->
                <section class="card">
                    <h2 class="text-2xl font-semibold mb-6">Calculate Your BMI</h2>
                    <div class="space-y-4">
                        <div><label class="block text-sm font-medium mb-1">Weight (kg)</label><input type="number" id="weight" class="inp" placeholder="70"></div>
                        <div><label class="block text-sm font-medium mb-1">Height (cm)</label><input type="number" id="height" class="inp" placeholder="175"></div>
                        <div class="flex gap-4"><button id="calcBtn" class="btn btn-p">Calculate</button><button id="rstBtn" class="btn btn-s">Reset</button></div>
                        <div id="err" class="text-red-600 text-sm hidden"></div>
                    </div>
                </section>

                <!-- Results -->
                <section id="resSec" class="card hidden">
                    <div class="text-center mb-6 bg-indigo-50 p-6 rounded-lg">
                        <p class="text-lg text-gray-600">Your BMI:</p>
                        <strong id="bmiVal" class="text-6xl font-bold text-indigo-600">0.0</strong>
                        <p id="bmiCat" class="mt-2 text-2xl font-medium"></p>
                    </div>
                    <div id="advBox" class="space-y-4"></div>
                </section>

                <!-- History -->
                <section id="histSec" class="card hidden">
                    <h2 class="text-2xl font-semibold mb-4">History</h2>
                    <div class="hist-list h-64 overflow-y-auto bg-gray-50 rounded-lg p-4 border">
                        <ul id="histList" class="space-y-3 text-sm text-gray-500 text-center"><li>No history yet.</li></ul>
                    </div>
                </section>
            </div>

            <!-- Right Column: Info -->
            <div class="flex flex-col gap-6">
                <aside class="card">
                    <h3 class="text-xl font-semibold mb-2">What is BMI?</h3>
                    <p class="text-sm text-gray-600">BMI measures body fat based on height/weight. It's a puzzle piece, ignoring muscle or bone density. Consult a doctor for real health checks.</p>
                </aside>
                
                <aside class="card">
                    <h3 class="text-xl font-semibold mb-2">Healthy Range?</h3>
                    <p class="text-sm text-gray-600 mb-2">BMI estimates risk for heart issues/stroke but isn't perfect.</p>
                    <h4 class="font-semibold text-sm mt-3">Limitations:</h4>
                    <ul class="list-disc pl-4 text-sm text-gray-600"><li>Athletes (high muscle)</li><li>Pregnant women</li><li>Certain ethnic groups</li></ul>
                </aside>

                <aside class="card overflow-x-auto">
                    <h3 class="text-xl font-semibold mb-4">Categories</h3>
                    <table class="w-full text-sm text-left"><tr class="border-b"><th class="py-2">Cat</th><th>Range</th></tr>
                    <tr class="text-blue-600 border-b"><td class="py-2">Under</td><td>&lt; 18.5</td></tr>
                    <tr class="text-green-600 border-b"><td class="py-2">Normal</td><td>18.5-24.9</td></tr>
                    <tr class="text-yellow-600 border-b"><td class="py-2">Over</td><td>25-29.9</td></tr>
                    <tr class="text-red-600"><td class="py-2">Obese</td><td>30+</td></tr></table>
                </aside>

                <aside class="card space-y-4">
                    <h3 class="text-xl font-semibold">Motivation</h3>
                    <div class="flex gap-3 items-center"><img src="https://placehold.co/50/6366F1/FFF?text=K" class="rounded-full w-12 h-12"><div><p class="font-bold text-indigo-600">Coach Kenji</p><p class="text-xs italic">"One step at a time!"</p></div></div>
                    <div class="flex gap-3 items-center"><img src="https://placehold.co/50/10B981/FFF?text=A" class="rounded-full w-12 h-12"><div><p class="font-bold text-green-600">Coach Aya</p><p class="text-xs italic">"Focus on progress, not perfection."</p></div></div>
                </aside>
            </div>
        </main>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, addDoc, collection, onSnapshot, query, Timestamp, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- CONFIGURATION ---
        // IMPORTANT: If publishing to GitHub, replace the {} below with your Firebase Config object!
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {
            // apiKey: "YOUR_API_KEY",
            // authDomain: "YOUR_PROJECT.firebaseapp.com",
            // projectId: "YOUR_PROJECT_ID",
            // storageBucket: "YOUR_PROJECT.appspot.com",
            // messagingSenderId: "...",
            // appId: "..."
        };
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        let uid = null, unsub = null;

        // DOM Elements
        const els = { 
            w: document.getElementById('weight'), h: document.getElementById('height'),
            calc: document.getElementById('calcBtn'), rst: document.getElementById('rstBtn'),
            res: document.getElementById('resSec'), bmi: document.getElementById('bmiVal'),
            cat: document.getElementById('bmiCat'), adv: document.getElementById('advBox'),
            err: document.getElementById('err'), authSt: document.getElementById('auth-status'),
            authBtn: document.getElementById('auth-btn'), histSec: document.getElementById('histSec'),
            histList: document.getElementById('histList')
        };

        // --- AUTHENTICATION ---
        onAuthStateChanged(auth, (u) => {
            if (u) {
                uid = u.uid;
                els.authSt.textContent = `ID: ${uid.slice(0,6)}...`;
                els.authBtn.textContent = "Sign Out"; els.authBtn.onclick = () => signOut(auth);
                els.histSec.classList.remove('hidden');
                loadHistory();
            } else {
                uid = null; els.authSt.textContent = "Track History";
                els.authBtn.textContent = "Sign In"; els.authBtn.onclick = () => signInAnonymously(auth);
                els.histSec.classList.add('hidden');
                if(unsub) unsub();
                els.histList.innerHTML = '<li>Sign in to see history</li>';
            }
        });

        function loadHistory() {
            // Using 'artifacts' collection as per specific environment rules, change to 'users' for standard apps if needed
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default'; 
            const q = query(collection(db, `artifacts/${appId}/users/${uid}/bmiEntries`));
            unsub = onSnapshot(q, (snap) => {
                const d = []; snap.forEach(doc => d.push(doc.data()));
                d.sort((a,b) => (b.date?.toMillis?.() || 0) - (a.date?.toMillis?.() || 0));
                els.histList.innerHTML = d.length ? d.map(i => 
                    `<li class="flex justify-between p-2 bg-white rounded border">
                        <span><b>${i.bmi}</b> <small>(${i.cat})</small></span>
                        <small>${new Date(i.date?.toDate?.() || i.date).toLocaleDateString()}</small>
                    </li>`
                ).join('') : '<li class="text-center p-2">No records yet.</li>';
            });
        }

        // --- LOGIC ---
        const advice = {
            'Underweight': { c: 'text-blue-600', d: ['Eat nutrient-dense foods (nuts, avocado).','Eat 5-6 small meals.','Add smoothies.'], e: ['Focus on strength training.','Limit excessive cardio.'] },
            'Normal Weight': { c: 'text-green-600', d: ['Maintain balanced diet.','Hydrate well.','Mindful eating.'], e: ['150mins aerobic/week.','Strength 2 days/week.'] },
            'Overweight': { c: 'text-yellow-600', d: ['Portion control.','Reduce sugar/processed foods.','Increase fiber.'], e: ['Daily brisk walking.','Gradually increase intensity.'] },
            'Obese': { c: 'text-red-600', d: ['Focus on whole foods.','Sustainable calorie deficit.','Consult a pro.'], e: ['Low impact (swim, walk).','Consistent movement.'] }
        };

        els.calc.addEventListener('click', () => {
            const w = parseFloat(els.w.value), h = parseFloat(els.h.value);
            if (!w || !h || w<=0 || h<=0) return els.err.classList.remove('hidden'), els.err.textContent = "Enter valid numbers!";
            els.err.classList.add('hidden');

            const bmi = (w / ((h/100)**2)).toFixed(1);
            const cat = bmi < 18.5 ? 'Underweight' : bmi < 25 ? 'Normal Weight' : bmi < 30 ? 'Overweight' : 'Obese';
            const data = advice[cat];

            els.bmi.textContent = bmi; els.cat.textContent = cat; els.cat.className = `mt-2 text-2xl font-medium ${data.c}`;
            
            const mkList = (l) => l.map(x => `<div class="flex gap-2"><span class="text-green-500">âœ“</span><span class="text-sm">${x}</span></div>`).join('');
            els.adv.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-gray-50 p-3 rounded border"><h4 class="font-bold text-green-700 mb-2">Diet</h4>${mkList(data.d)}</div>
                    <div class="bg-gray-50 p-3 rounded border"><h4 class="font-bold text-blue-700 mb-2">Exercise</h4>${mkList(data.e)}</div>
                </div><p class="text-xs text-center text-gray-400 mt-2">Consult a doctor before starting.</p>`;
            
            els.res.classList.remove('hidden');
            
            if(uid) {
                const appId = typeof __app_id !== 'undefined' ? __app_id : 'default';
                addDoc(collection(db, `artifacts/${appId}/users/${uid}/bmiEntries`), { bmi, cat, date: Timestamp.now() });
            }
        });

        els.rst.addEventListener('click', () => {
            els.w.value = ''; els.h.value = ''; els.res.classList.add('hidden'); els.err.classList.add('hidden');
        });
    </script>
</body>
</html>


